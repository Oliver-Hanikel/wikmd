FROM python:alpine

COPY . /app/wikmd
WORKDIR /app/wikmd

RUN \
  echo "**** install wikmd dependencies ****" && \
  apk add --no-cache git gcc linux-headers musl-dev pkgconfig && \
  apk add --no-cache md4c md4c-dev --repository=http://dl-cdn.alpinelinux.org/alpine/edge/testing && \
  \
  echo "**** install pip requirements ****" && \
  pip3 install pkgconfig && \
  pip3 install -r requirements.txt && \
  \
  echo "**** cleanup ****" && \
  pip3 uninstall -y pkgconfig && \
  pip3 cache purge && \
  apk del gcc linux-headers md4c-dev musl-dev pkgconfig

ENV LANG=C.UTF-8
ENV HOME=/wiki
ENV WIKI_DIRECTORY=/wiki
ENV WIKMD_LOGGING_FILE=/var/log/wikmd.log

EXPOSE 5000

CMD ["docker/entrypoint.sh"]

